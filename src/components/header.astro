---
import logo from "../assets/LA.svg";

const links = [
  { name: "Inicio", href: "#home" },
  { name: "Sobre mí", href: "#about" },
  { name: "Trabajo", href: "#experience"},
  { name: "Tecnologías", href: "#technologies" },
  // { name: "Proyectos", href: "#projects" },
];
---

<header class="flex justify-between items-center h-15 w-[90%] md:w-[80%] lg:w-[60%] mx-auto sticky px-4 top-2 z-50 py-4 border border-white/10 rounded-xl bg-[#010b13]/80 backdrop-blur-lg">
  <!-- Logo -->
  <div class="flex gap-2">
    <a href="#home" class="flex items-center gap-2">
      <img src={logo.src} alt="logo de Luis Alvarez" width="25" />
      <span class="text-xl font-semibold"><strong class="text-[#07f9a2]">.</strong>dev</span>
    </a>
  </div>

  <!-- Menú en escritorio -->
  <nav class="hidden md:flex gap-5">
    <ul class="flex gap-5 items-center">
      {links.map((link) => (
        <li>
          <a
            href={link.href}
            class="font-semibold hover:text-gray-300 transition-colors relative group"
            data-section={link.href.substring(1)}
          >
            {link.name}
            <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-[#07f9a2] transition-all duration-300 group-hover:w-full"></span>
            <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-[#07f9a2] transition-all duration-300 active-section"></span>
          </a>
        </li>
      ))}
      <li>
        <a
          href="#contact"
          class="text-[#07f9a2] bg-[#07f9a2]/10 border border-[#07f9a2]/5 rounded-xl py-1 px-4 font-semibold italic"
        >
          Contáctame!
        </a>
      </li>
    </ul>
  </nav>

  <!-- Botón hamburguesa -->
  <button
    id="menu-btn"
    class="md:hidden text-2xl text-[#07f9a2] bg-[#07f9a2]/10 border border-[#07f9a2]/5 rounded-xl flex items-center justify-center w-10 h-10 focus:outline-none"
    aria-label="Abrir menú"
  >
    <i class="hn hn-bars-solid"></i>
  </button>
</header>

<!-- Drawer lateral -->
<div
  id="mobile-menu"
  class="fixed top-0 right-0 h-screen w-64 bg-[#010b13]/95 border-l border-white/10 shadow-lg p-6 backdrop-blur-xl transform translate-x-full transition-transform duration-300 ease-in-out z-50 md:hidden"
>
  <!-- Botón cerrar -->
  <button id="close-btn" class="text-2xl text-[#07f9a2] w-10 h-10 flex items-center justify-center absolute top-4 right-13">
    <i class="hn hn-times-solid"></i>
  </button>

  <ul class="flex flex-col gap-6 mt-12">
    {links.map((link) => (
      <li>
        <a
          href={link.href}
          class="font-semibold text-lg hover:text-gray-300 transition-colors"
        >
          {link.name}
        </a>
      </li>
    ))}
    <li>
      <a
        href="#contact"
        class="text-[#07f9a2] bg-[#07f9a2]/10 border border-[#07f9a2]/5 rounded-xl py-2 px-6 font-semibold shadow-white/40 hover:shadow-md transition transform hover:scale-105 italic"
      >
        Contáctame!
      </a>
    </li>
  </ul>
</div>

<!-- Script para toggle + smooth scroll -->
<script is:inline>
  const menuBtn = document.getElementById("menu-btn");
  const closeBtn = document.getElementById("close-btn");
  const mobileMenu = document.getElementById("mobile-menu");

  const openMenu = () => mobileMenu.classList.remove("translate-x-full");
  const closeMenu = () => mobileMenu.classList.add("translate-x-full");

  menuBtn.addEventListener("click", openMenu);
  closeBtn.addEventListener("click", closeMenu);
  document.addEventListener('DOMContentLoaded', () => {
    updateActiveSection();
    
    // Agregar un pequeño retraso para asegurar que el DOM esté completamente cargado
    setTimeout(updateActiveSection, 100);
  });
  
  // Ejecutar al hacer scroll con debounce para mejorar rendimiento
  let isScrolling;
  window.addEventListener('scroll', () => {
    window.clearTimeout(isScrolling);
    isScrolling = setTimeout(() => {
      updateActiveSection();
    }, 50);
  }, false);

  function updateActiveSection() {
    // Obtener todas las secciones con ID
    const sections = Array.from(document.querySelectorAll('section[id]'));
    
    // Si no hay secciones, salir
    if (sections.length === 0) return;
    
    // Ocultar todos los indicadores
    document.querySelectorAll('.active-section').forEach(indicator => {
      indicator.style.width = '0%';
    });
    
    // Si estamos en la parte superior de la página, activar el enlace de inicio
    if (window.scrollY < 100) {
      const homeLink = document.querySelector('a[data-section="home"]');
      if (homeLink) {
        const activeIndicator = homeLink.querySelector('.active-section');
        if (activeIndicator) {
          activeIndicator.style.width = '100%';
        }
      }
      return;
    }
    
    // Encontrar la sección más cercana al centro de la ventana
    const viewportCenter = window.scrollY + (window.innerHeight / 2);
    let closestSection = null;
    let minDistance = Infinity;
    
    sections.forEach(section => {
      const rect = section.getBoundingClientRect();
      const sectionMiddle = window.scrollY + rect.top + (rect.height / 2);
      const distance = Math.abs(viewportCenter - sectionMiddle);
      
      if (distance < minDistance) {
        minDistance = distance;
        closestSection = section;
      }
    });
    
    // Si encontramos una sección cercana, activar su indicador
    if (closestSection) {
      const sectionId = closestSection.getAttribute('id');
      if (sectionId) {
        const menuLink = document.querySelector(`a[data-section="${sectionId}"]`);
        if (menuLink) {
          const activeIndicator = menuLink.querySelector('.active-section');
          if (activeIndicator) {
            activeIndicator.style.width = '100%';
          }
        }
      }
    }
    
    // Activar solo la sección más cercana
    if (closestSection) {
      const sectionId = closestSection.getAttribute('id');
      const menuLink = document.querySelector(`a[data-section="${sectionId}"]`);
      
      if (menuLink) {
        const activeIndicator = menuLink.querySelector('.active-section');
        activeIndicator.style.width = '100%';
      }
    }
  }

  // Smooth scroll + cerrar drawer
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener("click", (e) => {
      e.preventDefault();
      const targetId = anchor.getAttribute("href");
      
      // Manejar el caso especial del inicio
      if (targetId === "#" || targetId === "#home") {
        window.scrollTo({
          top: 0,
          behavior: "smooth"
        });
        closeMenu();
        return;
      }
      
      if (!targetId) return;

      const targetElement = document.querySelector(targetId);
      if (targetElement) {
        targetElement.scrollIntoView({ behavior: "smooth", block: "start" });
        closeMenu();
      }
    });
  });
</script>
